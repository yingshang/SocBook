# LINUX系统通信

来到Centos7系统代理端（192.168.1.101），**修改wazuh配置文件（/var/ossec/etc/ossec.conf，**管理端和代理端的配置文件都是在一个位置上面）。

&lt;ossec\_config&gt;这个标签是wazuh配置文件的顶级标签，可以设置多个顶级标签。作为树级结构，一层一层内容往下递进。设置代理端和管理端通信的是在address标签里面，默认配置文件时显示MANAGER\_IP这些字符，所以启动服务是无法启动的，所以需要修改为管理端的IP地址，也就是192.168.1.200。（**代理端主机名字不能和管理端主机名一样，否则会报错**）

![](../../../.gitbook/assets/image%20%2822%29.png)

修改完成之后，运行wazuh通信验证程序，使用wazuh自带命令agent-auth，其中可以使用的参数如图下所示：

![](../../../.gitbook/assets/image%20%2827%29%20%281%29.png)

由于管理端默认是没有设置通信密码，也就是代理端可以直接发送验证请求过来完成通信动作。**使用-m参数**与可以直接管理端进行通信，如图所示，提示验证过程中没有密码提供，代理端没有经过管理端的校验就能通信，之后管理端发送通信公钥给客户端，代理端在本地生成公钥文件，用于之后的加密通信。但是在实际过程中，为了考虑安全性，必须要设置通信密码，后续这一块在鉴权机制那一块详细说明。

![&#x4EE3;&#x7406;&#x7AEF;&#x9A8C;&#x8BC1;&#x8FC7;&#x7A0B;](../../../.gitbook/assets/image%20%2814%29.png)

在管理端与代理端通信认证成功之后，但是这样还没有彻底完成通信，在管理端看到代理端的状态显示是从来没有连接过（Never connected）。

![](../../../.gitbook/assets/image%20%2819%29.png)

还需要把代理端服务重新启动，使用**/var/ossec/bin/ossec-control restart**命令。

![](../../../.gitbook/assets/image%20%2828%29.png)

最后在管理端查看代理端连接信息发现状态是**活动（active），说明已经连接成功。**

![](../../../.gitbook/assets/image%20%2818%29.png)



